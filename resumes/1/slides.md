fusion tech casual #1

#  git

---

## agenda

- gitとは
 - バージョン管理システム
 - 分散バージョン管理システム
 - git
- githubにおけるコラボレーション
- gitの運用フロー
 - github-flow
 - チケットとコミットの紐付け

---

![](img/git.jpg)

--

git = 分散バージョン管理システム

分散? バージョン管理システム?

---

## バージョン管理システム(VCS)

wikipediaによると


> コンピュータ上で作成、編集されるファイルの変更履歴を管理するためのシステム。
> 特にソフトウェア開発においてソースコードの管理に用いられることが多い。

 VCS = Version Controll System

---

### なぜVCSが必要か?

- 複数人で編集する際の問題を解決
 - ファイルの最新状態が分からなくなる
 - 編集内容が競合する
 - お互いの変更内容が分からなくなる
- 変更内容の特定や切り戻しを行うため
- githubと併用することでレビューや課題管理などができる

---

### 主な機能

- バージョン間の比較
- 過去バージョンへの復元
- 衝突する変更のマージ
- ブランチ

---

### メジャーなVCS


- 集中型
  - Subversion
  - CVS
- 分散型
  - git
  - mercurial
  - bazaar


---


### 基本的な利用方法

![](img/fig1.png)

--

1. ファイルをリポジトリに登録する。
  - リポジトリ = バージョンを管理しているデータベース
2. ファイルをリポジトリからローカル環境に取り出す（チェックアウト）
3. ローカル環境で、ファイルに対し変更を行う。
4. 変更したファイルをリポジトリに書き戻す（チェックイン）
</aside>

---


### demo

- ファイルを2回変更して
 - コミット
 - 差分を見る
 - 最初のバージョンに戻す


---


## 分散バージョン管理システム


![](img/fig2.png)

--


- ユーザーそれぞれのコンピューターにリポジトリの「クローン」を作成する
- リポジトリ間で変更の同期やコピーをすることができる
- ネットワークに繋がっていなくてもバージョン管理できる

---

![](img/git.jpg)

- Linuxカーネルのソースコード管理に用いるためにリーナス・トーバルズによって開発された
- 現在ソフトウェア開発で最も利用されている(要出典)

--

### git クライアント

リポジトリに対する操作を行えるソフトウェアはいくつか公開されている

- git(win, mac, linux): コマンドライン
- SourceTree (mac, win): GUI
- TortoiseGit(win): エクスプローラーに統合
- github, gitlab(web): 後で説明
- 各言語でのライブラリ

---

## gitの機能(分岐と統合)

commit graph

![](img/git_graph.png)

- あるバージョンをリビジョンと呼び履歴を有向グラフで表すことができる(図の丸)
 - version: 版; バージョン
 - revision: 改訂,訂正, 修正, 校閲; ちょっとした修正
- しかし単一の履歴グラフでは複数の変更を同時に進めていくことができない

--

#### branch

![](img/git_branch.png)

- あるリビジョンから分岐して複数の履歴を管理することができる
- 分岐した枝をブランチ(branch)と呼ぶ
- すべてのブランチの元となるブランチをmasterブランチと呼ぶ

--

### merge

![](img/git_merge.png)


- branchに作成分岐された変更を特定のブランチにまとめて適用することができる

--

### fast-forward merge


![](img/git_ff_merge.png)

- 取り込み先に変更がなければマージする変更を付け加えるだけになる


--

### rebase

![](img/git_rebase_before.png)
![](img/git_rebase_after.png)

- rebaseは変更履歴のグラフを書き換えることができる
- 別ブランチの変更を現在のブランチの履歴に追加する

--

### rebase -i

- コミットメッセージを変更する
- コミット内容を修正する
- コミットを分割する
- コミットをまとめる
- コミットを削除する

--

### cherry-pick

![](img/git_cherry-pick.png)

- 別のブランチから特定のリビジョンでの変更だけを取り込むことができる

--

### conflict

rebase/merge するときに取り込み先と取り込み元で同じファイルへの変更があった場合は
手動で変更箇所を修正する必要がある


--

## clone/push/pull

clone: 別のコンピュータにあるリポジトリを丸ごとコピー

![](img/git_clone.png)

--

push: ローカルのコミットをリモートへ送信(逆向きはpull)

![](img/git_push.png)

---

# Collaborate

![](img/github-logo.png)


---

## gitの運用フロー

- gitflow: Linux Kernel の開発など大規模なソフトウェアの開発で利用されている
- github-flow: github(または類似のシステム)を軸に単一のリポジトリで運用していく

--

### github-flow

- masterブランチのものは、いつでもデプロイ出来る状態で無ければならない
- 新しい何かに取り組む際は、masterからブランチを作成する
- 作成したブランチは、説明的な名前を付ける（例: new-oauth2-scopes）
- 作成したブランチは、定期的にgithub上へgit pushする
- フィードバックや助言、ブランチのマージをして欲しいときは、github上でpull requestを作成する
- 他の誰かがレビューをする。
- OKが出たら、masterへmargeできる

[Github-flowを分かりやすく図解してみた](http://b.pyar.bz/blog/2014/01/22/github-flow/) より引用

--

![](img/git_branch.png)

- 新しい何かに取り組む際は、masterからブランチを作成する
- 作成したブランチは、説明的な名前を付ける（例: new-oauth2-scopes）
- 作成したブランチは、定期的にgithub上へgit pushする
 - pushしなくても作業はできるが早期にレビューするのが良いプラクティス

--

![](img/git_merge.png)

- フィードバックや助言、ブランチのマージをして欲しいときは、github上でpull requestを作成する
- 他の誰かがレビューをする。
- OKが出たら、masterへmargeできる

--

## チケットとコミットの紐付け

コミットログにチケット名を含めることで作業の目的、詳細と変更内容を紐付けできる

- redmineやgithub上でタスク単位でチケットを作成する
 - 例: 不具合を修正する, 週ごとの売上集計を追加する など
- コミットログにsee #XXX, refs #xxxx といった形式でチケット番号を含める
- あるタスクに関連する変更を一覧することができる
- ソースコードに書ききれない詳細をチケットに記録しておくことができる

--

### demo

- このスライドのリモートリポジトリをclone
- 「スライド作者名を追記する」というチケットを作成する
- branchを作って変更をcommitする
- リモートへpushしてマージリクエストを作成する
- マージリクエストにコメントをつける(レビュー)
- マージリクエストをmerge(マージ)

--

### コツや注意点

チームごとに決めておくといいこと

- コミット単位は小さく
 - 1コミット1チケットくらいが目安
 - 何日もコミットできないのは粒度が大きすぎる
- pushも頻繁に行う
 - コードが他人の目に触れる機会が増えてフィードバックを早期にもらえる
 - チームがどんな作業をしているのかわかりやすい
- マージリクエストは早めに
 - コンフリクトする確率はどんどん上がっていく
 - 分量が多いとレビューする方もされる方もしんどい

--

### 続き

- ブランチ名の命名規則を決めておく
 - `作者/トピック名` とか
- masterにはpushしない/rebaseしない
 - レビューしてない変更は取り入れない
 - masterはメンバーがみんなチェックアウトするのでrebaseするとローカルのmasterと整合性が取れなくなる
- コミットログには変更内容よりも変更した理由を書く
 - 変更内容は差分をみればわかる。なぜその変更をしたのかは分からない

---

# github

ソフトウェア開発プロジェクトのためのソースコード管理サービス

- gitの公開リポジトリを作成できる
- 公開されているソースコードの閲覧
- 簡単なバグ管理機能
- wiki
- Pull Request

--

## githubの使われ方

- GitHubを使ってバージョン管理,ソフトウェアの公開を行っている企業.
 - facebook, Microsoft, Google, Netflix, Cyboze, Cookpad, DeNA
 - OSS活動: ソフトウェアのコードを公開することでフィードバックや改善を受け付ける
- ソフトウェア以外にも書籍の執筆、法律案の作成
- 社内でもgithubと同等の機能のgitlabを運用している




